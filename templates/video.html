{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Youtube</title>
    <link rel="icon" href="{% static 'images/youtube-icon.png' %}">
    <link rel="stylesheet" href="{% static 'css/style.css' %}" type="text/css">
    <link rel="stylesheet" href="{% static 'css/single.css' %}" type="text/css">
    

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css" integrity="sha384-3B6NwesSXE7YJlcLI9RpRqGf2p/EgVH8BgoKTaUrmKNDkHPStTQ3EyoYjCGXaOTS" crossorigin="anonymous" />

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.24.0/axios.min.js" integrity="sha512-u9akINsQsAkG9xjc1cnGF4zw5TFDwkxuc9vUp5dltDWYCSmyd0meygbvgXrlc/z7/o4a19Fb5V0OUE58J7dcyw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


    <style>
    
        a{
            color: black;
        }
        .unsubscribe-btn{
            background-color: gray;
            color: #fff;
        }
    </style>
    

</head>




<body>
    
    <div class="header">
        <div class="header-left">
            <i id="menu" class="material-icons">menu</i>
            <a href="{% url 'index' %}">
                <img  src="https://www.xda-developers.com/files/2017/08/After-12-Years-Google-Gives-YouTube-a-New-Logo-1900x700_c.png" alt="">
            </a>

        </div>

        <div class="header-search">
            <form action="">
                <input type="text" placeholder="search">
                <button><i class="material-icons">search</i></button>
            </form>
        </div>

        <div class="header-icons">
            <i class="material-icons display-this">search</i>
            <i class="material-icons display-this">videocam</i>
            <i class="material-icons display-this">apps</i>
            <i class="material-icons display-this">notifications</i>
            <i id="drop-down" class="material-icons display-this">account_circle</i>

        </div>

    </div>

    <main class="single-pages">
        <section class="video-items flex">
            <div class="left">
                <div class="left-content">
                    <video controls>
                        <source src="{{video.video.url}}" type="video/mp4" poster="images/1.jpg">
                    </video>

                    <div class="tag">
                        <label for="" class="tags">
                            {% for tag in video.tags.all %}
                                #{{tag.name}}
                            {% endfor %}
                            
                        </label>
                        <p>{{video.title}}</p>
                    </div>

                    <div class="view flex2 border-bottom">
                        <div class="view-text">
                            <span>{{video.views}} View</span>
                        </div>

                        <div class="flex">
                            <div class="icon">
                                <a href=""><i class="fa fa-thumbs-up"></i></a>
                                <label for="">5k</label>
                            </div>

                            <div class="icon">
                                <a href=""><i class="fa fa-thumbs-down"></i></a>
                                <label for="">Deslike</label>
                            </div>

                            <div class="icon">
                                <a href=""><i class="fa fa-share"></i></a>
                                <label for="">Share</label>
                            </div>

                            <div class="icon">
                                <a href=""><i class="fa fa-scissors"></i></a>
                                <label for="">Clips</label>
                            </div>

                            <div class="icon">
                                <a href=""><i class="fa fa-bookmark"></i></a>
                                <label for="">Save</label>
                            </div>

                            <div class="icon">
                                <a href=""><i class="fa fa-ellipsis"></i></a>
                            </div>
                        </div>
                    </div>

    <!-- Channel        --------------------------->

                    <div class="details flex border-bottom">
                        <div class="img">
                            <img 
                                src="{{video.user.channel.image.url}}" 
                                alt=""
                            >
                        </div>
                        
                        <div class="heading">
                            <h4>
                                {{video.user.channel.channel_name}}
                                {% if video.user.channel.verified == True %} <i class="fas fa-check-circle"></i> {% endif %}     
                            </h4>
                            <span id="count">{{video.user.channel.subscribers.all.count}}</span> <span>Subscribers</span>
                            <h5>{{video.description}}</h5>
                            <span> <i class="fa fa-caret-down"></i> show more</span>
                        </div>

                        <div>
                            <button  id="sub_btn" onclick="addsub()" class="subscribe-btn">
                                Subscribe
                            </button>
                        </div>
                    </div>
                    <hr>






        <!-- Comment        ------------------------------------>



                    <hr class="mid-hr">

                    <div class="comment">
                        <div class="comment-heading flex">
                            <h4><b>{{comment.count}} Comments</b></h4>
                            <h4><i class="fas fa-list-ul"></i> <label>Sort By</label> </h4>
                        </div>
                    </div>



                    <div class="details comment-self flex">
                        <div class="img">
                            <img src="https://cdn-icons-png.flaticon.com/512/1144/1144760.png" alt="">
                        </div>
                        
                        {% if request.user.is_authenticated %}
                        <form action="" style="width: 100%;" id="comment_form">

                            {% csrf_token %}
                            <div class="heading flex">
                                <input type="hidden" value="{{ video.id }}" id="id" name="id">
                                <input type="text" placeholder="Add a comment..." id="comment" name="comment">
                                <button ><i class="material-icons">send</i></button>
                            </div>
                        </form>
                        {% else %}
                            <a href="../../admin/login" style="margin-top: 10px;">*Login To Comment</a>
                        {% endif %}
                     
                    </div>


                        <!-- Comment form -->

                    <div id="comment-wrapper">

                        {% for c in comment %}
                        <div class="comment-tray">

                            <div class="details-Comment">
                                <div class="details flex">
        
                                    <div class="img">
                                        <img  src="https://cdn-icons-png.flaticon.com/512/1144/1144760.png"  alt="">
                                    </div>
                                    <div class="heading">
                                        <h4><b>{{c.user.username|title}} </b> &nbsp; •<span>{{c.date|timesince}} ago</span></h4>
                                        <p>{{c.comment}}</p>         
            
                                        <div class="comment-like flex">
                                            <div class="icon">
                                                <i class="fa fa-thumbs-up"></i>
                                                <label for=""><small>2</small></label>
                                            </div>
            
                                            <div class="icon">
                                                <i class="fa fa-thumbs-down"></i>
                                                <label for=""><small>Dislike</small></label>
                                            </div>
            
                                            <div class="icon">
                                                <label for=""><a><small>Reply</small></a></label>
                                            </div>

                                            <div class="icon">
                                                <input type="hidden" value="{{ c.id }}" name="" id="">
                                                <label for=""><button data-cid={{c.id}} class="btn-del" style="color: red;"><small>Delete</small></button></label>
                                            </div>
            
                                        </div>
                                    </div>
        
        
                                </div>
                            </div>

                            <!-- Comment Reply -->
                            <div class="replay">
                                <label for="" class="tags"><i class="fa fa-caret-up"></i>Hide Reply</label>
                                <div class="replay-details flex">
                                    <div class="img">
                                        <img  src="https://cdn-icons-png.flaticon.com/512/1144/1144760.png"  alt="">
                                    </div>
                                    <div class="text">
                                        <h4><label for="">Desphixs</label><i class="fas fa-check-circle"></i><span>16 Months ago</span> </h4>
                                        <p>Thank you</p>
                                    </div>
                                </div>
                            </div>
                            <hr>
                        </div>

                        {% endfor %}
                    </div>

                </div>
            </div>


            <!-- Right Content -->

            <div class="right">
                <div class="right-content">
                    <button class="chat">Show Chat Reply</button>
                    <div class="tags">
                        <label for="" class="tags-bg">All</label>
                        <label for="" class="tags-bg">Web Design</label>
                        <label for="" class="tags-bg">Frontend</label>
                        <label for="" class="tags-bg">HTML</label>
                    </div>

                    <div class="video-items video-sidebar flex">
                        <a href="">
                            <img src="{% static 'images/1.jpg' %}" alt="">
                        </a>
                        <div class="details">
                            <p>Youtube Clone Using HTML, CSS and JS</p>
                            <span>Dephixs<i class="fa fa-check-circle"></i></span>
                            <span><small>203 K Views . 1 Week Ago</small> </span>
                        </div>
                    </div>

                    <div class="video-items video-sidebar flex">
                        <a href="">
                            <img src="{% static 'images/1.jpg' %}" alt="">
                        </a>
                        <div class="details">
                            <p>Youtube Clone Using HTML, CSS and JS</p>
                            <span>Dephixs<i class="fa fa-check-circle"></i></span>
                            <span><small>203 K Views . 1 Week Ago</small> </span>
                        </div>
                    </div>

                    <div class="video-items video-sidebar flex">
                        <a href="">
                            <img src="{% static 'images/1.jpg' %}" alt="">
                        </a>
                        <div class="details">
                            <p>Youtube Clone Using HTML, CSS and JS</p>
                            <span>Dephixs<i class="fa fa-check-circle"></i></span>
                            <span><small>203 K Views . 1 Week Ago</small> </span>
                        </div>
                    </div>

                    
                </div>
            </div>
        </section>
    </main>
    

    <!-- <script src="{% static 'js/main.js' %}"></script> -->
</body>
</html>





<!-- Ajax  ------------------- -->

<script type="text/javascript">
    $(document).on('submit','#comment_form',function(e){
        e.preventDefault()
        let _comment = $("#comment").val()
        console.log(_comment);

        $.ajax({
            type: "POST",
            url: "{% url 'save-comment' %}",
            data: {
                id: $("#id").val(),
                comment: _comment,
                csrfmiddlewaretoken: $("input[name=csrfmiddlewaretoken]").val()
            },
            success: function(){
                console.log("Comment passed to backend");

                let _html =  '<div class="details-Comment">\
                        <div class="details flex">\
                            <div class="img">\
                                <img  src="https://thumbs.dreamstime.com/b/default-avatar-profile-icon-vector-social-media-user-portrait-176256935.jpg" alt="">\
                            </div>\
                            <div class="heading">\
                                <h4><b>{{request.user.username|title}}</b> &nbsp; •<span>{% now "H:i" %}</span></h4>\
                                <p> '+ _comment +' </p>\
                                <div class="comment-like flex">\
                                    <div class="icon">\
                                        <i class="fa fa-thumbs-up"></i>\
                                        <label for=""><small>2</small></label>\
                                    </div>\
                                    <div class="icon">\
                                        <i class="fa fa-thumbs-down"></i>\
                                        <label for=""><small>Dislike</small></label>\
                                    </div>\
                                    <div class="icon">\
                                        <label for=""><a><small>Reply</small></a></label>\
                                    </div>\
                                    <div class="icon">\
                                        <input type="hidden" value="{{ c.id }}" name="" id="">\
                                        <label for=""><button data-cid={{c.id}} class="btn-del" style="color: red;"><small>Delete</small></button></label>\
                                    </div>\
                                </div>\
                            </div>\
                        </div>\
                    </div>\
                    <div class="replay">\
                        <label for="" class="tags"><i class="fa fa-caret-up"></i>Hide Reply</label>\
                        <div class="replay-details flex">\
                            <div class="img">\
                                <img  src="https://cdn-icons-png.flaticon.com/512/1144/1144760.png"  alt="">\
                            </div>\
                            <div class="text">\
                                <h4><label for="">Desphixs</label><i class="fas fa-check-circle"></i><span>16 Months ago</span></h4>\
                                <p>Thank you</p>\
                            </div>\
                        </div>\
                    </div>\
                    <hr>\
                    '
                   
                    $("#comment-wrapper").prepend(_html)
                    $("#comment").val("")

            },
            error: function(error){
                console.log(error);
            }
        })
    })

    // Deleting Comment
    $("#comment-wrapper").on("click", ".btn-del", function(){
        console.log("Delete Comment Button is Clicked");
        let id = $(this).attr("data-cid")

        mydata = {
            cid:id
        }
        mythis = $(this)

        $.ajax({
            type: "POST",
            url: "{% url 'delete-comment' %}",
            data: mydata,

            success: function(data){
                // console.log(data);
                if(data.status === 1){
                    // console.log("Comment Deleted");
                    $(mythis).closest(".comment-tray").fadeOut();
                }
                if(data.status === 0){
                    // console.log("Unable To Delete Comment");
                    alert("Unable to delete comment, try again later...")
                }
            }
        }) 

    })


</script>


<!-- Subscribe Feature -->
<script>
    let subcounter = document.getElementById('count')
    sub_button = document.getElementById('sub_btn')
    subscriber_added = []
    
    function addsub(){
        axios
        .get('{% url "add_sub" video.user.id %}')
        .then(response =>{
                this.response = response.data;
                sub_button.innerHTML =  this.response;
                loadsub()
                // sub_button.classList.remove('loading')
                sub_button.classList.toggle("unsubscribe-btn")
        })
    }
    
    function loadsub(){
        axios
        .get('{% url "subLoad" channel.pk %}')
        .then(response =>{
                this.response = response.data;
                subscriber_added = this.response
                subcounter.innerHTML = subscriber_added.length

    
        })
    }
    
    window.onload = loadsub;
</script>

